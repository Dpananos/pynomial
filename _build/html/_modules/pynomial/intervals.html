

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pynomial.intervals &mdash; pynomial  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            pynomial
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pynomial</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pynomial.intervals</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pynomial.intervals</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ConfidenceIntervalType</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enumeration of available confidence interval methods for binomial proportions.</span>

<span class="sd">    This enum defines the supported methods for computing confidence intervals,</span>
<span class="sd">    each with different statistical properties and use cases.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        WALD: Wald interval based on normal approximation</span>
<span class="sd">        AGRESTI_COULL: Agresti-Coull interval with pseudo-observations</span>
<span class="sd">        ARCSINE: Arcsine transformation interval</span>
<span class="sd">        BAYESIAN_BETA: Bayesian interval using Beta prior</span>
<span class="sd">        CLOPPER_PEARSON: Exact (Clopper-Pearson) interval</span>
<span class="sd">        WILSON: Wilson (score) interval</span>
<span class="sd">        LOGIT: Logit transformation interval</span>
<span class="sd">        CLOGLOG: Complementary log-log transformation interval</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">WALD</span> <span class="o">=</span> <span class="s2">&quot;wald&quot;</span>
    <span class="n">AGRESTI_COULL</span> <span class="o">=</span> <span class="s2">&quot;agresti_coull&quot;</span>
    <span class="n">ARCSINE</span> <span class="o">=</span> <span class="s2">&quot;arcsine&quot;</span>
    <span class="n">BAYESIAN_BETA</span> <span class="o">=</span> <span class="s2">&quot;bayesian_beta&quot;</span>
    <span class="n">CLOPPER_PEARSON</span> <span class="o">=</span> <span class="s2">&quot;clopper_pearson&quot;</span>
    <span class="n">WILSON</span> <span class="o">=</span> <span class="s2">&quot;wilson&quot;</span>
    <span class="n">LOGIT</span> <span class="o">=</span> <span class="s2">&quot;logit&quot;</span>
    <span class="n">CLOGLOG</span> <span class="o">=</span> <span class="s2">&quot;cloglog&quot;</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ConfidenceInterval</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Result object containing confidence interval information.</span>

<span class="sd">    This dataclass holds all the information about a computed confidence interval</span>
<span class="sd">    including the method used, confidence level, point estimate, and bounds.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        type (ConfidenceIntervalType): The method used to compute the interval</span>
<span class="sd">        confidence_level (float): The confidence level (e.g., 0.95 for 95%)</span>
<span class="sd">        point_estimate (float): The point estimate of the proportion</span>
<span class="sd">        lower (float): Lower bound of the confidence interval</span>
<span class="sd">        upper (float): Upper bound of the confidence interval</span>

<span class="sd">    Note:</span>
<span class="sd">        All proportion values (point_estimate, lower, upper) are in the range [0, 1].</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">type</span><span class="p">:</span> <span class="n">ConfidenceIntervalType</span>
    <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">point_estimate</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">lower</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_z_score</span><span class="p">(</span><span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the critical z-score for a given confidence level.</span>

<span class="sd">    Args:</span>
<span class="sd">        confidence_level (float): Confidence level between 0 and 1 (default: 0.95)</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The critical z-score corresponding to the confidence level</span>

<span class="sd">    Example:</span>
<span class="sd">        For 95% confidence level, returns approximately 1.96</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">confidence_level</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_check_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate input parameters for confidence interval functions.</span>

<span class="sd">    Performs comprehensive validation of input parameters including:</span>
<span class="sd">    - None value checks</span>
<span class="sd">    - Array broadcasting compatibility</span>
<span class="sd">    - Valid ranges for all parameters</span>

<span class="sd">    Args:</span>
<span class="sd">        x: Number of successes (scalar or array-like, 0 ≤ x ≤ n)</span>
<span class="sd">        n: Number of trials (scalar or array-like, n &gt; 0)</span>
<span class="sd">        confidence_level (float): Confidence level between 0 and 1 (default: 0.95)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If any input parameter is invalid or if arrays are not broadcastable</span>

<span class="sd">    Note:</span>
<span class="sd">        This function supports broadcasting, allowing x, n, and confidence_level</span>
<span class="sd">        to be arrays of compatible shapes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;x and n must not be None&quot;</span><span class="p">)</span>

    <span class="n">x_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">n_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">confidence_level_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">confidence_level</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">broadcast_shapes</span><span class="p">(</span><span class="n">x_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">confidence_level_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;x, n, and confidence_level must be broadcastable to the same shape&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">x_arr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;x must be between 0 and n&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">n_arr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;n must be greater than 0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">x_arr</span> <span class="o">&gt;</span> <span class="n">n_arr</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;x must be between 0 and n&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">confidence_level_arr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">confidence_level_arr</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;confidence_level must be between 0 and 1&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_highest_density_interval_beta</span><span class="p">(</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute highest posterior density interval for Beta distribution.</span>

<span class="sd">    This function finds the shortest interval that contains the specified</span>
<span class="sd">    probability mass for a Beta distribution. The highest density interval</span>
<span class="sd">    minimizes the interval width while maintaining the desired coverage.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (float): Alpha parameter (shape1) of the Beta distribution (a &gt; 0)</span>
<span class="sd">        b (float): Beta parameter (shape2) of the Beta distribution (b &gt; 0)</span>
<span class="sd">        confidence_level (float): Desired coverage probability (0 &lt; confidence_level &lt; 1)</span>
<span class="sd">        tol (float): Convergence tolerance for the iterative algorithm (default: 1e-8)</span>
<span class="sd">        max_iter (int): Maximum number of iterations (default: 1000)</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[float, float]: Lower and upper bounds of the highest density interval</span>

<span class="sd">    Note:</span>
<span class="sd">        This implements the algorithm from R&#39;s binom package C code.</span>
<span class="sd">        Falls back to equal-tailed interval if convergence fails.</span>
<span class="sd">        Raises a warning if convergence fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">confidence_level</span>

    <span class="n">lcl</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">ucl</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="n">lcl_density</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">lcl</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">ucl_density</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">ucl</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="n">target_density</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lcl_density</span><span class="p">,</span> <span class="n">ucl_density</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="n">target_density</span>

    <span class="n">first_is_upper</span> <span class="o">=</span> <span class="n">lcl_density</span> <span class="o">&lt;</span> <span class="n">ucl_density</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span> <span class="o">+</span> <span class="n">y3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">first_is_upper</span><span class="p">:</span>
                <span class="n">lcl_new</span> <span class="o">=</span> <span class="n">_find_beta_density_root</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
                <span class="n">ucl_new</span> <span class="o">=</span> <span class="n">_find_beta_density_root</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lcl_new</span> <span class="o">=</span> <span class="n">_find_beta_density_root</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
                <span class="n">ucl_new</span> <span class="o">=</span> <span class="n">_find_beta_density_root</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>

            <span class="n">coverage</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">ucl_new</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">lcl_new</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coverage</span> <span class="o">-</span> <span class="n">confidence_level</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lcl_new</span><span class="p">,</span> <span class="n">ucl_new</span>

            <span class="k">if</span> <span class="n">coverage</span> <span class="o">&gt;</span> <span class="n">confidence_level</span><span class="p">:</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="n">y2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y3</span> <span class="o">=</span> <span class="n">y2</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;Failed to converge to highest density interval for Beta distribution; &quot;</span>
        <span class="s2">&quot;falling back to equal-tailed interval.&quot;</span><span class="p">,</span>
        <span class="ne">RuntimeWarning</span><span class="p">,</span>
        <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">lcl</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">ucl</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lcl</span><span class="p">,</span> <span class="n">ucl</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_find_beta_density_root</span><span class="p">(</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">target_density</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">x_lower</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">x_upper</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the root where Beta distribution density equals target density.</span>

<span class="sd">    This helper function is used by the highest density interval algorithm</span>
<span class="sd">    to find points where the Beta probability density function equals a</span>
<span class="sd">    specified target value.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (float): Alpha parameter of the Beta distribution</span>
<span class="sd">        b (float): Beta parameter of the Beta distribution</span>
<span class="sd">        target_density (float): Target density value to find roots for</span>
<span class="sd">        x_lower (float): Lower bound for root search</span>
<span class="sd">        x_upper (float): Upper bound for root search</span>
<span class="sd">        tol (float): Tolerance for root finding</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The x-value where pdf(x) ≈ target_density</span>

<span class="sd">    Note:</span>
<span class="sd">        Uses Brent&#39;s method for root finding. Falls back to midpoint</span>
<span class="sd">        if root finding fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">brentq</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">density_diff</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">target_density</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">density_diff</span><span class="p">(</span><span class="n">x_lower</span><span class="p">)</span> <span class="o">*</span> <span class="n">density_diff</span><span class="p">(</span><span class="n">x_upper</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">density_diff</span><span class="p">(</span><span class="n">x_lower</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">density_diff</span><span class="p">(</span><span class="n">x_upper</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">x_lower</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x_upper</span>

        <span class="k">return</span> <span class="n">brentq</span><span class="p">(</span><span class="n">density_diff</span><span class="p">,</span> <span class="n">x_lower</span><span class="p">,</span> <span class="n">x_upper</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="n">tol</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x_lower</span> <span class="o">+</span> <span class="n">x_upper</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_continuity_corrected_wilson</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfidenceInterval</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wilson confidence interval with continuity correction.</span>

<span class="sd">    This implementation applies a continuity correction to the Wilson interval</span>
<span class="sd">    to better account for the discrete nature of binomial data. The correction</span>
<span class="sd">    generally improves coverage for small to moderate sample sizes.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (int): Number of successes (0 ≤ x ≤ n)</span>
<span class="sd">        n (int): Number of trials (n &gt; 0)</span>
<span class="sd">        confidence_level (float): Confidence level between 0 and 1 (default: 0.95)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ConfidenceInterval: Object containing the confidence interval bounds and metadata</span>

<span class="sd">    Note:</span>
<span class="sd">        This is an internal helper function used by the wilson() function when</span>
<span class="sd">        correct_continuity=True is specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_check_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">)</span>
    <span class="n">z_score</span> <span class="o">=</span> <span class="n">_z_score</span><span class="p">(</span><span class="n">confidence_level</span><span class="p">)</span>
    <span class="n">pe</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">n</span>

    <span class="n">z_squared</span> <span class="o">=</span> <span class="n">z_score</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">two_n_pe</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="n">pe</span>
    <span class="n">n_plus_z_squared</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="n">z_squared</span>
    <span class="n">four_pe_minus_2</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">pe</span> <span class="o">-</span> <span class="mi">2</span>
    <span class="n">four_n_pe_one_minus_pe</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="n">pe</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pe</span><span class="p">)</span>

    <span class="n">sqrt_term_lower</span> <span class="o">=</span> <span class="n">z_squared</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">four_n_pe_one_minus_pe</span> <span class="o">+</span> <span class="n">four_pe_minus_2</span>
    <span class="n">sqrt_term_upper</span> <span class="o">=</span> <span class="n">z_squared</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">four_n_pe_one_minus_pe</span> <span class="o">-</span> <span class="n">four_pe_minus_2</span>

    <span class="n">sqrt_lower</span> <span class="o">=</span> <span class="n">z_score</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sqrt_term_lower</span><span class="p">)</span>
    <span class="n">sqrt_upper</span> <span class="o">=</span> <span class="n">z_score</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sqrt_term_upper</span><span class="p">)</span>

    <span class="n">lower_numerator</span> <span class="o">=</span> <span class="n">two_n_pe</span> <span class="o">+</span> <span class="n">z_squared</span> <span class="o">-</span> <span class="n">sqrt_lower</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">upper_numerator</span> <span class="o">=</span> <span class="n">two_n_pe</span> <span class="o">+</span> <span class="n">z_squared</span> <span class="o">+</span> <span class="n">sqrt_upper</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">lower</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lower_numerator</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n_plus_z_squared</span><span class="p">))</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper_numerator</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n_plus_z_squared</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ConfidenceInterval</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">ConfidenceIntervalType</span><span class="o">.</span><span class="n">WILSON</span><span class="p">,</span>
        <span class="n">confidence_level</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="o">=</span><span class="n">pe</span><span class="p">,</span>
        <span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span>
        <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_wilson_no_continuity</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfidenceInterval</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wilson confidence interval without continuity correction.</span>

<span class="sd">    This implementation computes the standard Wilson (score) interval without</span>
<span class="sd">    any continuity correction. It provides the basic Wilson interval formula</span>
<span class="sd">    derived from inverting the score test.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (int): Number of successes (0 ≤ x ≤ n)</span>
<span class="sd">        n (int): Number of trials (n &gt; 0)</span>
<span class="sd">        confidence_level (float): Confidence level between 0 and 1 (default: 0.95)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ConfidenceInterval: Object containing the confidence interval bounds and metadata</span>

<span class="sd">    Note:</span>
<span class="sd">        This is an internal helper function used by the wilson() function when</span>
<span class="sd">        correct_continuity=False is specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_check_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">)</span>
    <span class="n">z_score</span> <span class="o">=</span> <span class="n">_z_score</span><span class="p">(</span><span class="n">confidence_level</span><span class="p">)</span>

    <span class="n">pe</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_score</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">pe</span>
    <span class="n">discrim</span> <span class="o">=</span> <span class="n">z_score</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">z_score</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">pe</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pe</span><span class="p">))</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">z_score</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">n</span>

    <span class="n">lower</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">discrim</span><span class="p">))</span> <span class="o">/</span> <span class="n">denom</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">discrim</span><span class="p">))</span> <span class="o">/</span> <span class="n">denom</span>

    <span class="k">return</span> <span class="n">ConfidenceInterval</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">ConfidenceIntervalType</span><span class="o">.</span><span class="n">WILSON</span><span class="p">,</span>
        <span class="n">confidence_level</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="o">=</span><span class="n">pe</span><span class="p">,</span>
        <span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span>
        <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">,</span>
    <span class="p">)</span>


<div class="viewcode-block" id="wald">
<a class="viewcode-back" href="../../index.html#pynomial.intervals.wald">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wald</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfidenceInterval</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wald confidence interval for binomial proportions.</span>

<span class="sd">    The Wald interval is based on the normal approximation to the binomial distribution.</span>
<span class="sd">    It uses the standard error of the proportion to construct symmetric confidence bounds</span>
<span class="sd">    around the sample proportion.</span>

<span class="sd">    .. math::</span>
<span class="sd">        CI = \\hat{p} \\pm z_{\\alpha/2} \\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{n}}</span>

<span class="sd">    where :math:`\\hat{p} = x/n` is the sample proportion and :math:`z_{\\alpha/2}` is the </span>
<span class="sd">    critical value from the standard normal distribution.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (int): Number of successes (0 ≤ x ≤ n)</span>
<span class="sd">        n (int): Number of trials (n &gt; 0)</span>
<span class="sd">        confidence_level (float): Confidence level between 0 and 1 (default: 0.95)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ConfidenceInterval: Object containing the confidence interval bounds and metadata</span>

<span class="sd">    Note:</span>
<span class="sd">        The Wald interval can perform poorly for extreme proportions (near 0 or 1)</span>
<span class="sd">        or small sample sizes. Consider using Wilson or Clopper-Pearson intervals</span>
<span class="sd">        for better coverage in these cases.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_check_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">)</span>
    <span class="n">z_score</span> <span class="o">=</span> <span class="n">_z_score</span><span class="p">(</span><span class="n">confidence_level</span><span class="p">)</span>
    <span class="n">pe</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">standard_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pe</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pe</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">pe</span> <span class="o">-</span> <span class="n">z_score</span> <span class="o">*</span> <span class="n">standard_error</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">pe</span> <span class="o">+</span> <span class="n">z_score</span> <span class="o">*</span> <span class="n">standard_error</span>

    <span class="k">return</span> <span class="n">ConfidenceInterval</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">ConfidenceIntervalType</span><span class="o">.</span><span class="n">WALD</span><span class="p">,</span>
        <span class="n">confidence_level</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="o">=</span><span class="n">pe</span><span class="p">,</span>
        <span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span>
        <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="agresti_coull">
<a class="viewcode-back" href="../../index.html#pynomial.intervals.agresti_coull">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">agresti_coull</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfidenceInterval</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Agresti-Coull confidence interval for binomial proportions.</span>

<span class="sd">    This method adds pseudo-observations to improve the coverage properties of</span>
<span class="sd">    the Wald interval, particularly for small sample sizes and extreme proportions.</span>
<span class="sd">    It adds :math:`z^2/2` successes and :math:`z^2/2` failures to the data.</span>

<span class="sd">    .. math::</span>
<span class="sd">        \\tilde{x} &amp;= x + \\frac{z^2}{2} \\\\</span>
<span class="sd">        \\tilde{n} &amp;= n + z^2 \\\\</span>
<span class="sd">        \\tilde{p} &amp;= \\frac{\\tilde{x}}{\\tilde{n}} \\\\</span>
<span class="sd">        CI &amp;= \\tilde{p} \\pm z_{\\alpha/2} \\sqrt{\\frac{\\tilde{p}(1-\\tilde{p})}{\\tilde{n}}}</span>

<span class="sd">    where :math:`z = z_{\\alpha/2}` is the critical value from the standard normal distribution.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (int): Number of successes (0 ≤ x ≤ n)</span>
<span class="sd">        n (int): Number of trials (n &gt; 0)</span>
<span class="sd">        confidence_level (float): Confidence level between 0 and 1 (default: 0.95)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ConfidenceInterval: Object containing the confidence interval bounds and metadata</span>

<span class="sd">    Note:</span>
<span class="sd">        The point estimate returned is the original sample proportion x/n,</span>
<span class="sd">        while the interval bounds use the adjusted proportion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_check_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">)</span>
    <span class="n">z_score</span> <span class="o">=</span> <span class="n">_z_score</span><span class="p">(</span><span class="n">confidence_level</span><span class="p">)</span>
    <span class="n">adjusted_x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">z_score</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">adjusted_n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="n">z_score</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">raw_pe</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">pe</span> <span class="o">=</span> <span class="n">adjusted_x</span> <span class="o">/</span> <span class="n">adjusted_n</span>
    <span class="n">standard_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pe</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pe</span><span class="p">)</span> <span class="o">/</span> <span class="n">adjusted_n</span><span class="p">)</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">pe</span> <span class="o">-</span> <span class="n">z_score</span> <span class="o">*</span> <span class="n">standard_error</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">pe</span> <span class="o">+</span> <span class="n">z_score</span> <span class="o">*</span> <span class="n">standard_error</span>

    <span class="k">return</span> <span class="n">ConfidenceInterval</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">ConfidenceIntervalType</span><span class="o">.</span><span class="n">AGRESTI_COULL</span><span class="p">,</span>
        <span class="n">confidence_level</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="o">=</span><span class="n">raw_pe</span><span class="p">,</span>
        <span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span>
        <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="arcsine">
<a class="viewcode-back" href="../../index.html#pynomial.intervals.arcsine">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">arcsine</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfidenceInterval</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arcsine confidence interval for binomial proportions.</span>

<span class="sd">    The arcsine transformation (also known as angular transformation) stabilizes</span>
<span class="sd">    the variance of the binomial proportion. This method uses an adjusted proportion</span>
<span class="sd">    and applies the arcsine square-root transformation to construct confidence intervals.</span>

<span class="sd">    This implementation follows the R DescTools package formula:</span>

<span class="sd">    .. math::</span>
<span class="sd">        \\tilde{p} &amp;= \\frac{x + 0.375}{n + 0.75} \\\\</span>
<span class="sd">        \\theta &amp;= \\arcsin(\\sqrt{\\tilde{p}}) \\\\</span>
<span class="sd">        \\text{margin} &amp;= \\frac{z_{\\alpha/2}}{2\\sqrt{n}} \\\\</span>
<span class="sd">        CI &amp;= [\\sin^2(\\theta - \\text{margin}), \\sin^2(\\theta + \\text{margin})]</span>

<span class="sd">    where :math:`z_{\\alpha/2}` is the critical value from the standard normal distribution.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (int): Number of successes (0 ≤ x ≤ n)</span>
<span class="sd">        n (int): Number of trials (n &gt; 0)</span>
<span class="sd">        confidence_level (float): Confidence level between 0 and 1 (default: 0.95)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ConfidenceInterval: Object containing the confidence interval bounds and metadata</span>

<span class="sd">    Note:</span>
<span class="sd">        The arcsine transformation is particularly useful for proportions near</span>
<span class="sd">        the boundaries (0 or 1) and provides good coverage properties.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_check_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">)</span>
    <span class="n">z_score</span> <span class="o">=</span> <span class="n">_z_score</span><span class="p">(</span><span class="n">confidence_level</span><span class="p">)</span>

    <span class="n">pe</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">n</span>

    <span class="n">p_tilde</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.375</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mf">0.75</span><span class="p">)</span>
    <span class="n">arcsine_p_tilde</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p_tilde</span><span class="p">))</span>

    <span class="n">margin</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">z_score</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arcsine_p_tilde</span> <span class="o">-</span> <span class="n">margin</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arcsine_p_tilde</span> <span class="o">+</span> <span class="n">margin</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="k">return</span> <span class="n">ConfidenceInterval</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">ConfidenceIntervalType</span><span class="o">.</span><span class="n">ARCSINE</span><span class="p">,</span>
        <span class="n">confidence_level</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="o">=</span><span class="n">pe</span><span class="p">,</span>
        <span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span>
        <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="bayesian_beta">
<a class="viewcode-back" href="../../index.html#pynomial.intervals.bayesian_beta">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">bayesian_beta</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">prior_alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">prior_beta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span>
    <span class="n">interval_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;central&quot;</span><span class="p">,</span>
    <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfidenceInterval</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bayesian confidence interval using Beta prior.</span>

<span class="sd">    Based on R&#39;s binom.bayes function from the binom package.</span>

<span class="sd">    Args:</span>
<span class="sd">        x: Number of successes</span>
<span class="sd">        n: Number of trials</span>
<span class="sd">        prior_alpha: Prior alpha parameter (shape1), default 0.5 (Jeffreys prior)</span>
<span class="sd">        prior_beta: Prior beta parameter (shape2), default 0.5 (Jeffreys prior)</span>
<span class="sd">        confidence_level: Confidence level</span>
<span class="sd">        interval_type: Either &quot;central&quot; (equal-tailed) or &quot;highest&quot; (highest density interval)</span>
<span class="sd">        tol: Tolerance for convergence (used for highest density intervals)</span>
<span class="sd">        max_iter: Maximum iterations for convergence</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_check_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">prior_alpha</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">prior_beta</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;prior_alpha and prior_beta must be greater than 0&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">interval_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;central&quot;</span><span class="p">,</span> <span class="s2">&quot;highest&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;interval_type must be &#39;central&#39; or &#39;highest&#39;&quot;</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">prior_alpha</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">x</span> <span class="o">+</span> <span class="n">prior_beta</span>

    <span class="n">posterior_mean</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">confidence_level</span>

    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">interval_type</span> <span class="o">==</span> <span class="s2">&quot;central&quot;</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">interval_type</span> <span class="o">==</span> <span class="s2">&quot;central&quot;</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">interval_type</span> <span class="o">==</span> <span class="s2">&quot;central&quot;</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">_highest_density_interval_beta</span><span class="p">(</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">max_iter</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">ConfidenceInterval</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">ConfidenceIntervalType</span><span class="o">.</span><span class="n">BAYESIAN_BETA</span><span class="p">,</span>
        <span class="n">confidence_level</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="o">=</span><span class="n">posterior_mean</span><span class="p">,</span>
        <span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span>
        <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="clopper_pearson">
<a class="viewcode-back" href="../../index.html#pynomial.intervals.clopper_pearson">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">clopper_pearson</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfidenceInterval</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clopper-Pearson exact confidence interval for binomial proportions.</span>

<span class="sd">    This method provides exact coverage by using the relationship between</span>
<span class="sd">    the binomial and beta distributions. It guarantees that the actual</span>
<span class="sd">    coverage probability is at least the nominal confidence level.</span>

<span class="sd">    The confidence interval bounds are given by:</span>

<span class="sd">    .. math::</span>
<span class="sd">        \\text{Lower bound} &amp;= \\text{Beta}_{\\alpha/2}(x, n-x+1) \\\\</span>
<span class="sd">        \\text{Upper bound} &amp;= \\text{Beta}_{1-\\alpha/2}(x+1, n-x)</span>

<span class="sd">    where :math:`\\text{Beta}_{p}(a,b)` is the :math:`p`-th quantile of the Beta distribution </span>
<span class="sd">    with parameters :math:`a` and :math:`b`, and :math:`\\alpha = 1 - \\text{confidence_level}`.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (int): Number of successes (0 ≤ x ≤ n)</span>
<span class="sd">        n (int): Number of trials (n &gt; 0)</span>
<span class="sd">        confidence_level (float): Confidence level between 0 and 1 (default: 0.95)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ConfidenceInterval: Object containing the confidence interval bounds and metadata</span>

<span class="sd">    Special cases:</span>
<span class="sd">        - When x=0: lower bound = 0</span>
<span class="sd">        - When x=n: upper bound = 1</span>

<span class="sd">    Note:</span>
<span class="sd">        This is the most conservative method, providing exact coverage but</span>
<span class="sd">        potentially wider intervals than approximate methods. Also known as</span>
<span class="sd">        the &quot;exact&quot; method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_check_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">)</span>
    <span class="n">pe</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">confidence_level</span>

    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ConfidenceInterval</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">ConfidenceIntervalType</span><span class="o">.</span><span class="n">CLOPPER_PEARSON</span><span class="p">,</span>
        <span class="n">confidence_level</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="o">=</span><span class="n">pe</span><span class="p">,</span>
        <span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span>
        <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="wilson">
<a class="viewcode-back" href="../../index.html#pynomial.intervals.wilson">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wilson</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">correct_continuity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfidenceInterval</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wilson confidence interval for binomial proportions.</span>

<span class="sd">    The Wilson interval (also known as score interval) provides better coverage</span>
<span class="sd">    properties than the Wald interval, especially for small sample sizes and</span>
<span class="sd">    extreme proportions. It can optionally include a continuity correction.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (int): Number of successes (0 ≤ x ≤ n)</span>
<span class="sd">        n (int): Number of trials (n &gt; 0)</span>
<span class="sd">        correct_continuity (bool): Whether to apply continuity correction (default: True)</span>
<span class="sd">        confidence_level (float): Confidence level between 0 and 1 (default: 0.95)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ConfidenceInterval: Object containing the confidence interval bounds and metadata</span>

<span class="sd">    Note:</span>
<span class="sd">        The Wilson interval is generally recommended over the Wald interval</span>
<span class="sd">        due to its superior coverage properties. The continuity correction</span>
<span class="sd">        generally improves performance for discrete data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">correct_continuity</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_continuity_corrected_wilson</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_wilson_no_continuity</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">)</span></div>



<div class="viewcode-block" id="logit">
<a class="viewcode-back" href="../../index.html#pynomial.intervals.logit">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">logit</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfidenceInterval</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Logit transformation confidence interval for binomial proportions.</span>

<span class="sd">    The logit transformation stabilizes the variance and constrains the</span>
<span class="sd">    confidence interval to the valid range [0,1]. This method transforms</span>
<span class="sd">    the proportion to the logit scale, applies normal theory, then</span>
<span class="sd">    transforms back to the probability scale.</span>

<span class="sd">    The transformation and confidence interval are given by:</span>

<span class="sd">    .. math::</span>
<span class="sd">        \\text{logit}(\\hat{p}) &amp;= \\ln\\left(\\frac{\\hat{p}}{1-\\hat{p}}\\right) \\\\</span>
<span class="sd">        SE_{\\text{logit}} &amp;= \\sqrt{\\frac{1}{n\\hat{p}(1-\\hat{p})}} \\\\</span>
<span class="sd">        \\text{logit}(CI) &amp;= \\text{logit}(\\hat{p}) \\pm z_{\\alpha/2} \\cdot SE_{\\text{logit}} \\\\</span>
<span class="sd">        CI &amp;= \\left[\\frac{e^{L}}{1+e^{L}}, \\frac{e^{U}}{1+e^{U}}\\right]</span>

<span class="sd">    where :math:`L` and :math:`U` are the lower and upper bounds on the logit scale,</span>
<span class="sd">    and :math:`\\hat{p} = x/n` is the sample proportion.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (int): Number of successes (0 ≤ x ≤ n)</span>
<span class="sd">        n (int): Number of trials (n &gt; 0)</span>
<span class="sd">        confidence_level (float): Confidence level between 0 and 1 (default: 0.95)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ConfidenceInterval: Object containing the confidence interval bounds and metadata</span>

<span class="sd">    Special cases:</span>
<span class="sd">        - When x=0: lower = 0, upper calculated using beta distribution</span>
<span class="sd">        - When x=n: upper = 1, lower calculated using beta distribution</span>

<span class="sd">    Note:</span>
<span class="sd">        The logit transformation provides good coverage properties and</span>
<span class="sd">        naturally constrains intervals to [0,1], making it suitable</span>
<span class="sd">        for proportions near the boundaries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_check_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">)</span>
    <span class="n">z_score</span> <span class="o">=</span> <span class="n">_z_score</span><span class="p">(</span><span class="n">confidence_level</span><span class="p">)</span>
    <span class="n">pe</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">n</span>

    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">confidence_level</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">confidence_level</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">logit_pe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pe</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pe</span><span class="p">))</span>
        <span class="n">standard_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">pe</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pe</span><span class="p">)))</span>

        <span class="n">logit_lower</span> <span class="o">=</span> <span class="n">logit_pe</span> <span class="o">-</span> <span class="n">z_score</span> <span class="o">*</span> <span class="n">standard_error</span>
        <span class="n">logit_upper</span> <span class="o">=</span> <span class="n">logit_pe</span> <span class="o">+</span> <span class="n">z_score</span> <span class="o">*</span> <span class="n">standard_error</span>

        <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logit_lower</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logit_lower</span><span class="p">))</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logit_upper</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logit_upper</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ConfidenceInterval</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">ConfidenceIntervalType</span><span class="o">.</span><span class="n">LOGIT</span><span class="p">,</span>
        <span class="n">confidence_level</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="o">=</span><span class="n">pe</span><span class="p">,</span>
        <span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span>
        <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="cloglog">
<a class="viewcode-back" href="../../index.html#pynomial.intervals.cloglog">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cloglog</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfidenceInterval</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Complementary log-log transformation confidence interval for binomial proportions.</span>

<span class="sd">    The complementary log-log (cloglog) transformation is particularly useful</span>
<span class="sd">    when the true proportion is expected to be close to 0. This transformation</span>
<span class="sd">    provides asymmetric confidence intervals that can better capture the</span>
<span class="sd">    skewness in the sampling distribution.</span>

<span class="sd">    The transformation and confidence interval are given by:</span>

<span class="sd">    .. math::</span>
<span class="sd">        \\text{cloglog}(\\hat{p}) &amp;= \\ln(-\\ln(1-\\hat{p})) \\\\</span>
<span class="sd">        \\mu &amp;= \\ln(\\hat{p}) \\\\</span>
<span class="sd">        \\text{Var}[\\text{cloglog}(\\hat{p})] &amp;= \\frac{1-\\hat{p}}{n\\hat{p}\\mu^2} \\\\</span>
<span class="sd">        \\text{cloglog}(CI) &amp;= \\text{cloglog}(\\hat{p}) \\pm z_{\\alpha/2} \\sqrt{\\text{Var}[\\text{cloglog}(\\hat{p})]} \\\\</span>
<span class="sd">        CI &amp;= [\\exp(-\\exp(U)), \\exp(-\\exp(L))]</span>

<span class="sd">    where :math:`L` and :math:`U` are the lower and upper bounds on the cloglog scale,</span>
<span class="sd">    and :math:`\\hat{p} = x/n` is the sample proportion.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (int): Number of successes (0 ≤ x ≤ n)</span>
<span class="sd">        n (int): Number of trials (n &gt; 0)</span>
<span class="sd">        confidence_level (float): Confidence level between 0 and 1 (default: 0.95)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ConfidenceInterval: Object containing the confidence interval bounds and metadata</span>

<span class="sd">    Special cases:</span>
<span class="sd">        - When x=0: lower = 0, upper = :math:`1 - (\\alpha/2)^{1/n}`</span>
<span class="sd">        - When x=n: lower = :math:`(\\alpha/2)^{1/n}`, upper = 1</span>

<span class="sd">    Note:</span>
<span class="sd">        This method is especially recommended when studying rare events</span>
<span class="sd">        or when the true proportion is expected to be small.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_check_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">)</span>
    <span class="n">z_score</span> <span class="o">=</span> <span class="n">_z_score</span><span class="p">(</span><span class="n">confidence_level</span><span class="p">)</span>
    <span class="n">pe</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">confidence_level</span>
    <span class="n">alpha2</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">alpha</span>

    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha2</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">alpha2</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pe</span><span class="p">))</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pe</span><span class="p">)</span>
        <span class="n">var_cloglog</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pe</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">pe</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_cloglog</span><span class="p">)</span>

        <span class="n">lcl_loglog</span> <span class="o">=</span> <span class="n">log_mu</span> <span class="o">+</span> <span class="n">z_score</span> <span class="o">*</span> <span class="n">sd</span>
        <span class="n">ucl_loglog</span> <span class="o">=</span> <span class="n">log_mu</span> <span class="o">-</span> <span class="n">z_score</span> <span class="o">*</span> <span class="n">sd</span>

        <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lcl_loglog</span><span class="p">))</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ucl_loglog</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ConfidenceInterval</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">ConfidenceIntervalType</span><span class="o">.</span><span class="n">CLOGLOG</span><span class="p">,</span>
        <span class="n">confidence_level</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="o">=</span><span class="n">pe</span><span class="p">,</span>
        <span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span>
        <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">,</span>
    <span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Demetri Pananos.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>